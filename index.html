<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUY FROM ROMANIA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        .animate-scale-in {
            animation: scaleIn 0.3s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .animate-slide-in-right {
            animation: slideInRight 0.5s ease-out forwards;
        }
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        body::-webkit-scrollbar {
            display: none;
        }
        body {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .romanian-flag-gradient {
            background: linear-gradient(to right, #002B7F, #FCD116, #CE1126);
        }

        body.dark-mode {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        body.dark-mode #category-nav {
            background-color: rgba(45, 55, 72, 0.7);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        body.dark-mode #category-buttons-container button {
            background-color: #4a5568;
            color: #cbd5e0;
        }
        body.dark-mode #category-buttons-container button.bg-blue-600 {
            background-color: #2563eb;
            color: #ffffff;
        }
        body.dark-mode #products-section-title {
            color: #e2e8f0;
        }
        body.dark-mode .product-card-container {
            background-color: #2d3748;
        }
        body.dark-mode .product-card-container h3 {
            color: #e2e8f0;
        }
        body.dark-mode #product-modal .bg-white,
        body.dark-mode #wishlist-modal .bg-white {
            background-color: #2d3748;
        }
        body.dark-mode #product-modal h2,
        body.dark-mode #product-modal p.text-gray-700,
        body.dark-mode #wishlist-modal h2,
        body.dark-mode #wishlist-modal h4,
        body.dark-mode #wishlist-modal p.text-gray-600 {
            color: #e2e8f0;
        }
        body.dark-mode #product-modal p.text-blue-600 {
            color: #93c5fd;
        }
        body.dark-mode #close-modal-btn,
        body.dark-mode #close-wishlist-modal-btn {
            color: #cbd5e0;
        }
        body.dark-mode #theme-toggle,
        body.dark-mode #view-wishlist-btn {
            background-color: #4a5568;
            color: #e2e8f0;
        }
        body.dark-mode .add-to-wishlist-btn {
            background-color: #a0aec0; 
            color: #1a202c;
        }
        body.dark-mode .add-to-wishlist-btn.bg-pink-500 {
            background-color: #d53f8c; 
        }
        body.dark-mode .remove-from-wishlist-btn {
            background-color: #e53e3e; 
        }
        body.dark-mode .wishlist-item-card {
            background-color: #4a5568;
        }
        body.dark-mode #wishlist-count-badge {
            background-color: #ef4444; 
            color: #ffffff;
        }


        #category-nav {
            background-color: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        #category-buttons-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }
        #category-buttons-container.is-expanded {
            max-height: 500px;
        }
        #category-toggle-btn.rotated svg {
            transform: rotate(180deg);
        }

        @media (min-width: 768px) {
            #category-buttons-container {
                max-height: none !important;
                overflow: visible !important;
                display: flex !important;
            }
        }


        @keyframes buttonClickScale {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); } 
            100% { transform: scale(1); }
        }

        @keyframes iconRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); } 
        }

        .button-active-animation {
            animation: buttonClickScale 0.4s ease-out;
        }

        .icon-active-rotation {
            animation: iconRotate 0.4s ease-out;
        }


        #wishlist-count-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ef4444; 
            color: white;
            border-radius: 9999px; 
            padding: 2px 7px;
            font-size: 0.75rem; 
            font-weight: bold;
            line-height: 1;
            min-width: 20px; 
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transform: scale(0.9); 
            transform-origin: center;
            transition: transform 0.2s ease-out;
        }
        #view-wishlist-btn:hover #wishlist-count-badge {
            transform: scale(1); 
        }

        
        #view-wishlist-btn {
            position: fixed;
            bottom: 1rem; 
            right: 90px; 
            z-index: 50;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 flex flex-col">

    <header class="romanian-flag-gradient p-6 shadow-lg rounded-b-2xl relative">
        <div class="container mx-auto text-center">
            <h1 class="text-white text-5xl font-extrabold tracking-tight mb-4">
                <span class="block animate-fade-in">BUY FROM ROMANIA</span>
            </h1>
            <p class="text-blue-100 text-2xl font-semibold">
                Descoperă produse autentice românești!
            </p>
        </div>
        <button id="theme-toggle" class="fixed bottom-4 right-4 bg-gray-200 text-gray-800 p-3 rounded-full shadow-lg
                                         transition-all duration-300 ease-in-out transform hover:scale-110 focus:outline-none z-50">
            <span id="theme-icon">☀️</span>
        </button>
        <button id="view-wishlist-btn" class="bg-blue-500 text-white p-3 rounded-full shadow-lg
                                         transition-all duration-300 ease-in-out transform hover:scale-110 focus:outline-none relative">
            ❤️ Wishlist
            <span id="wishlist-count-badge" class="hidden">0</span>
        </button>
    </header>

    <nav id="category-nav" class="shadow-md py-4 sticky top-0 z-10">
        <div class="container mx-auto px-4">
            <div class="md:hidden flex justify-between items-center mb-2">
                <span id="mobile-selected-category" class="w-full text-center text-2xl font-bold text-blue-600">Toate</span>
                <button id="category-toggle-btn" class="absolute right-4 p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 transition-transform duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 transform rotate-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </button>
            </div>

            <div id="category-buttons-container" class="flex flex-wrap justify-center gap-3">
                
            </div>
        </div>
    </nav>

    <main class="container mx-auto my-8 p-4 flex-grow">
        <h2 id="products-section-title" class="text-4xl font-bold text-gray-800 mb-8 text-center animate-slide-in-right">
            Toate Produsele
        </h2>

        <div id="products-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            
        </div>
    </main>

    <footer class="bg-gray-800 text-white p-6 mt-8 rounded-t-2xl shadow-inner">
        <div class="container mx-auto text-center">
            <p>&copy; <span id="current-year"></span> KEYRIF. Toate drepturile rezervate.</p>
            <p class="text-sm text-gray-400 mt-2">
                Creat cu pasiune pentru produsele românești.
            </p>
        </div>
    </footer>

    <div id="product-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4 hidden animate-fade-in">
        <div class="bg-white rounded-xl shadow-2xl p-6 relative max-w-lg w-full transform animate-scale-in">
            <button id="close-modal-btn"
                    class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 text-2xl font-bold
                           transition-transform duration-200 hover:rotate-90 focus:outline-none"
                    aria-label="Închide">
                &times;
            </button>
            <div class="flex flex-col md:flex-row items-center md:items-start gap-6">
                <img id="modal-product-image"
                     src=""
                     alt=""
                     class="w-40 h-40 object-cover rounded-lg shadow-md flex-shrink-0"
                     onerror="this.onerror=null;this.src='https://placehold.co/160x160/CCCCCC/666666?text=Produs';"
                />
                <div class="text-center md:text-left">
                    <h2 id="modal-product-name" class="text-3xl font-bold text-gray-800 mb-2"></h2>
                    <p id="modal-product-store" class="text-blue-600 text-lg font-medium mb-3"></p>
                    <p id="modal-product-location" class="text-gray-700 text-lg mb-3"></p>
                    <p id="modal-product-description" class="text-gray-700 leading-relaxed"></p>

                    <button id="modal-add-to-wishlist-btn" class="mt-4 px-4 py-2 rounded-full font-bold text-white shadow-md transition-all duration-200">
                        Adaugă la Wishlist
                    </button>
                </div>
            </div>
        </div>
    </div>


    <div id="wishlist-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4 hidden animate-fade-in">
        <div class="bg-white rounded-xl shadow-2xl p-6 relative max-w-2xl w-full transform animate-scale-in">
            <button id="close-wishlist-modal-btn"
                    class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 text-2xl font-bold
                           transition-transform duration-200 hover:rotate-90 focus:outline-none"
                    aria-label="Închide Wishlist">
                &times;
            </button>
            <h2 class="text-3xl font-bold text-gray-800 mb-2 text-center">Wishlist-ul Meu</h2>
            <p id="wishlist-product-count" class="text-center text-gray-600 mb-6">Număr produse: 0</p>
            <div id="wishlist-items-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4 max-h-96 overflow-y-auto">
            </div>
            <p id="empty-wishlist-message" class="text-center text-gray-600 mt-4 hidden">Wishlist-ul este gol.</p>

            <p class="text-center text-sm text-gray-500 italic mt-4 dark:text-gray-400">
                * Lista este salvată doar în browserul tău și nu este disponibilă pe termen lung sau pe alte dispozitive.
            </p>
        </div>
    </div>

    <canvas id="sparkCanvas" class="fixed inset-0 pointer-events-none z-40"></canvas>

    <script>
        const productsData = [
            {
                id: 1,
                name: "Apă Minerală Borsec",
                category: "Apă",
                store: "Mega Image",
                image: "https://depozituldeapa.ro/wp-content/uploads/2022/04/depozituldeapaapaplata26.jpg",
                description: "Apă minerală naturală carbogazificată, bogată în minerale esențiale. Perfectă pentru hidratare zilnică sau pentru a însoți mesele.",
                location: "HARGHITA"
            },
            {
                id: 2,
                name: "Apă Plată Aqua Carpatica",
                category: "Apă",
                store: "Carrefour",
                image: "https://placehold.co/150x150/ADD8E6/FFFFFF?text=Aqua+Carpatica",
                description: "Apă minerală naturală plată, cu un conținut scăzut de sodiu, ideală pentru bebeluși și persoanele cu dietă specială. Pură și echilibrată.",
                location: "SUCEAVA"
            },
            {
                id: 3,
                name: "Pâine Albă Feliată",
                category: "Paine",
                store: "Lidl",
                image: "https://placehold.co/150x150/F0E68C/000000?text=Paine+Alba",
                location: "BUCURESTI"
            },
            {
                id: 4,
                name: "Pâine Integrală",
                category: "Paine",
                store: "Kaufland",
                image: "https://placehold.co/150x150/DAA520/FFFFFF?text=Paine+Integrala",
                description: "Pâine integrală bogată în fibre, preparată din cereale integrale. Contribuie la o digestie sănătoasă și oferă energie pe termen lung.",
                location: "CLUJ"
            },
            {
                id: 5,
                name: "Bere Ursus Premium",
                category: "Bauturi",
                store: "Auchan",
                image: "https://placehold.co/150x150/FFA07A/FFFFFF?text=Ursus",
                description: "Bere lager românească, cu gust echilibrat și răcoritor. Perfectă pentru a te relaxa după o zi lungă sau pentru a o savura alături de prieteni.",
                location: "CLUJ"
            },
            {
                id: 6,
                name: "Vin Roșu Fetească Neagră",
                category: "Bauturi",
                store: "Profy",
                image: "https://placehold.co/150x150/8B0000/FFFFFF?text=Feteasca+Neagra",
                description: "Vin roșu sec, cu arome intense de fructe de pădure și note subtile de condimente. Ideal pentru a însoți preparate din carne roșie sau brânzeturi maturate.",
                location: "VRANCEA"
            },
            {
                id: 7,
                name: "Lapte 3.5% grăsime",
                category: "Lactate",
                store: "Mega Image",
                image: "https://placehold.co/150x150/E0FFFF/000000?text=Lapte",
                description: "Lapte proaspăt, integral, cu 3.5% grăsime. O sursă excelentă de calciu și proteine, ideal pentru micul dejun sau în cafea.",
                location: "BRASOV"
            },
            {
                id: 8,
                name: "Iaurt Natural",
                category: "Lactate",
                store: "Lidl",
                image: "https://placehold.co/150x150/F5DEB3/000000?text=Iaurt",
                description: "Iaurt cremos, fără aditivi, preparat din lapte proaspăt. Perfect pentru o gustare sănătoasă sau ca bază pentru sosuri și dressing-uri.",
                location: "SIBIU"
            },
            {
                id: 9,
                name: "Salam de Sibiu",
                category: "Carne",
                store: "ORICE MAGAZIN",
                image: "https://placehold.co/150x150/8B4513/FFFFFF?text=Salam+Sibiu",
                description: "Salam tradițional românesc, afumat și maturat, cu o aromă distinctă și o textură fină. O delicatesă apreciată în toată țara.",
                location: "SIBIU"
            },
            {
                id: 10,
                name: "Cârnați de Pleșcoi",
                category: "Carne",
                store: "ORICE MAGAZIN",
                image: "https://placehold.co/150x150/A0522D/FFFFFF?text=Carnati+Plescoi",
                description: "Cârnați picanți, specifici zonei Buzăului, preparați după o rețetă autentică. Ideali pentru grătar sau fierți, alături de o mămăliguță.",
                location: "BUZAU"
            },
            {
                id: 11,
                name: "Telemea de Ibănești",
                category: "Lactate",
                store: "Mega Image",
                image: "https://placehold.co/150x150/D2B48C/000000?text=Telemea+Ibanesti",
                description: "Telemea maturată, cu gust intens și sărat, specifică zonei Ibănești. Excelentă în salate sau ca aperitiv.",
                location: "MURES"
            },
            {
                id: 12,
                name: "Mici de Grătar",
                category: "Carne",
                store: "Lidl",
                image: "https://placehold.co/150x150/8B0000/FFFFFF?text=Mici",
                description: "Mici tradiționali românești, pregătiți pentru grătar. Un preparat iconic, perfect pentru orice ocazie festină.",
                location: "BUCURESTI"
            },
            {
                id: 13,
                name: "Făină Albă de Grâu",
                category: "Făină și Zahăr",
                store: "Kaufland",
                image: "https://placehold.co/150x150/F5F5DC/000000?text=Faina+Alba",
                description: "Făină albă de grâu, tip 000, ideală pentru patiserie și cofetărie. Asigură o textură fină și pufoasă preparatelor.",
                location: "BRAILA"
            },
            {
                id: 14,
                name: "Zahăr Cristal",
                category: "Făină și Zahăr",
                store: "Auchan",
                image: "https://placehold.co/150x150/FFFFFF/000000?text=Zahar+Cristal",
                description: "Zahăr alb cristal, perfect pentru îndulcirea băuturilor și prepararea deserturilor.",
                location: "GALATI"
            },
            {
                id: 15,
                name: "Ulei de Floarea Soarelui",
                category: "Ulei și Oțet",
                store: "Carrefour",
                image: "https://placehold.co/150x150/FFD700/000000?text=Ulei+Floarea+Soarelui",
                description: "Ulei rafinat de floarea soarelui, ideal pentru gătit și prăjit. Un ingredient esențial în orice bucătărie.",
                location: "IASI"
            },
            {
                id: 16,
                name: "Oțet de Vin",
                category: "Ulei și Oțet",
                store: "Profy",
                image: "https://placehold.co/150x150/800000/FFFFFF?text=Otet+Vin",
                description: "Oțet de vin roșu, cu o aromă bogată și aciditate echilibrată. Perfect pentru salate și marinade.",
                location: "CONSTANTA"
            },
            {
                id: 17,
                name: "Ciocolata ROM",
                category: "Dulciuri",
                store: "ORICE MAGAZIN",
                image: "https://www.delumani.de/cdn/shop/files/kandia-dulce-dulciuri-si-snacks-default-title-rom-baton-de-ciocolata-29423435776118.jpg?v=1727463628",
                description: "Producția are loc la fabrica Kandia Dulce din București, pe Șoseaua Viilor nr.20, Sector 5. Kandia Dulce este cel mai mare producător român de dulciuri, deținând brandul ROM încă de la lansarea acestuia în 1964, iar batoanele și toate sortimentele ROM continuă să fie fabricate local pe linia de producție dedicată din București.",
                location: "BUCURESTI"
            },
            {
                id: 18,
                name: "Carne de Porc Comtim",
                category: "Carne",
                store: "Comtim",
                image: "https://www.comtim.ro/images/PP_cotlet.png",
                description: "Aceste produse provin integral din fermele proprii Comtim din România și nu se găsesc în alte magazine sau lanțuri naționale. Magazinul oferă o gamă variată: carne proaspătă, produse marinate, toate garantând trasabilitate și prospețime, dedicate exclusiv clienților acestui punct de vânzare.",
                location: "TIMISOARA"
            }
        ];

        let selectedCategory = 'Toate';
        let isCategoryNavExpanded = false;


        let wishlist = []; 
        const WISHLIST_STORAGE_KEY = 'buy_from_romania_wishlist';

        function loadWishlist() {
            const storedWishlist = localStorage.getItem(WISHLIST_STORAGE_KEY);
            if (storedWishlist) {
                try {
                    wishlist = JSON.parse(storedWishlist);
                } catch (e) {
                    console.error("Failed to parse wishlist from localStorage:", e);
                    wishlist = []; 
                }
            }
        }

        function saveWishlist() {
            localStorage.setItem(WISHLIST_STORAGE_KEY, JSON.stringify(wishlist));
            updateWishlistCountBadge(); 
        }

        function isProductInWishlist(productId) {
            return wishlist.includes(productId);
        }

        function addToWishlist(productId) {
            if (!isProductInWishlist(productId)) {
                wishlist.push(productId);
                saveWishlist();

                const currentModalProductId = document.getElementById('modal-add-to-wishlist-btn').getAttribute('data-product-id');
                if (parseInt(currentModalProductId) === productId) {
                    updateModalWishlistButton(productId);
                }
            }
        }

        function removeFromWishlist(productId) {
            wishlist = wishlist.filter(id => id !== productId);
            saveWishlist();

            const currentModalProductId = document.getElementById('modal-add-to-wishlist-btn').getAttribute('data-product-id');
            if (parseInt(currentModalProductId) === productId) {
                updateModalWishlistButton(productId);
            }
            renderWishlistItems(); 
        }

        function createProductCard(product) {
            const cardDiv = document.createElement('div');
            cardDiv.className = `product-card-container relative bg-white rounded-xl shadow-lg overflow-hidden
                                 transform transition-all duration-300 hover:scale-105 hover:shadow-xl
                                 flex flex-col items-center p-4 group`;
            
            cardDiv.onclick = () => showProductModal(product);

            cardDiv.innerHTML = `
                <img src="${product.image}"
                     alt="${product.name}"
                     class="w-32 h-32 object-cover rounded-lg mb-4 transform transition-transform duration-300 group-hover:rotate-2"
                     onerror="this.onerror=null;this.src='https://placehold.co/150x150/CCCCCC/666666?text=Produs';"
                />
                <h3 class="text-lg font-semibold text-gray-800 text-center mb-1">${product.name}</h3>
                <div class="absolute top-2 right-2 bg-blue-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-md">
                    ${product.store}
                </div>
            `;

            return cardDiv;
        }

        function renderProducts() {
            const productsContainer = document.getElementById('products-container');
            productsContainer.innerHTML = '';
            const productsSectionTitle = document.getElementById('products-section-title');

            const filteredProducts = selectedCategory === 'Toate'
                ? productsData
                : productsData.filter(product => product.category === selectedCategory);

            productsSectionTitle.textContent = selectedCategory === 'Toate' ? 'Toate Produsele' : `Produse din categoria: ${selectedCategory}`;

            filteredProducts.forEach(product => {
                productsContainer.appendChild(createProductCard(product));
            });
        }

        function renderCategoryButtons() {
            const categoryButtonsContainer = document.getElementById('category-buttons-container');
            const mobileSelectedCategorySpan = document.getElementById('mobile-selected-category');
            categoryButtonsContainer.innerHTML = '';

            const uniqueCategories = [...new Set(productsData.map(p => p.category))];
            const sortedCategories = uniqueCategories.sort();
            const categories = ["Toate", ...sortedCategories];

            mobileSelectedCategorySpan.textContent = selectedCategory;

            categories.forEach(category => {
                const button = document.createElement('button');
                button.textContent = category;
                button.className = `px-5 py-2 rounded-full font-medium text-lg
                                     transition-all duration-300 ease-in-out transform hover:scale-105`;
                if (selectedCategory === category) {
                    button.classList.add('bg-blue-600', 'text-white', 'shadow-md');
                } else {
                    button.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                }
                button.onclick = () => {
                    selectedCategory = category;
                    renderCategoryButtons();
                    renderProducts();
                    if (window.innerWidth < 768) {
                        toggleCategoryNav();
                    }
                };
                categoryButtonsContainer.appendChild(button);
            });
        }


        function updateModalWishlistButton(productId) {
            const modalWishlistBtn = document.getElementById('modal-add-to-wishlist-btn');
            const isInWishlist = isProductInWishlist(productId);

  
            modalWishlistBtn.onclick = null; 

            if (isInWishlist) {
                modalWishlistBtn.textContent = 'Elimină din Wishlist';
                modalWishlistBtn.classList.remove('bg-pink-500', 'bg-gray-400', 'cursor-not-allowed');
                modalWishlistBtn.classList.add('bg-red-500', 'hover:bg-red-600');
                modalWishlistBtn.disabled = false; 
                modalWishlistBtn.onclick = () => {
                    removeFromWishlist(productId);
                    updateModalWishlistButton(productId); 
                };
            } else {
                modalWishlistBtn.textContent = 'Adaugă la Wishlist';
                modalWishlistBtn.classList.remove('bg-red-500', 'hover:bg-red-600', 'bg-gray-400', 'cursor-not-allowed');
                modalWishlistBtn.classList.add('bg-pink-500', 'hover:bg-pink-600');
                modalWishlistBtn.disabled = false;
                modalWishlistBtn.onclick = () => {
                    addToWishlist(productId);
                    updateModalWishlistButton(productId); 
                };
            }
            modalWishlistBtn.setAttribute('data-product-id', productId);
        }


        function showProductModal(product) {
            const modal = document.getElementById('product-modal');
            document.getElementById('modal-product-image').src = product.image;
            document.getElementById('modal-product-image').alt = product.name;
            document.getElementById('modal-product-name').textContent = product.name;
            document.getElementById('modal-product-store').textContent = `Magazin: ${product.store}`;
            
            const modalProductLocation = document.getElementById('modal-product-location');
            if (product.location) {
                modalProductLocation.innerHTML = `<b>LOCATIE:</b> ${product.location}`;
                modalProductLocation.classList.remove('hidden');
            } else {
                modalProductLocation.classList.add('hidden');
            }

            document.getElementById('modal-product-description').textContent = product.description;

           
            updateModalWishlistButton(product.id);

            modal.classList.remove('hidden');
        }

        function hideProductModal() {
            const modal = document.getElementById('product-modal');
            modal.classList.add('hidden');
        }

        
        function updateWishlistCountBadge() {
            const badge = document.getElementById('wishlist-count-badge');
            const productCountText = document.getElementById('wishlist-product-count');
            const count = wishlist.length;

            if (count > 0) {
                badge.textContent = count;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
            productCountText.textContent = `Număr produse: ${count}`;
        }

       
        function renderWishlistItems() {
            const wishlistItemsContainer = document.getElementById('wishlist-items-container');
            const emptyWishlistMessage = document.getElementById('empty-wishlist-message');
            wishlistItemsContainer.innerHTML = ''; 

            updateWishlistCountBadge(); 
            if (wishlist.length === 0) {
                emptyWishlistMessage.classList.remove('hidden');
                return;
            } else {
                emptyWishlistMessage.classList.add('hidden');
            }

            wishlist.forEach(productId => {
                const product = productsData.find(p => p.id === productId);
                if (product) {
                    const wishlistItemDiv = document.createElement('div');
                    wishlistItemDiv.className = `wishlist-item-card bg-gray-100 dark:bg-gray-700 rounded-lg p-4 flex items-center space-x-4 shadow-sm`;
                    wishlistItemDiv.innerHTML = `
                        <img src="${product.image}" alt="${product.name}" class="w-16 h-16 object-cover rounded-md"
                             onerror="this.onerror=null;this.src='https://placehold.co/64x64/CCCCCC/666666?text=Produs';"/>
                        <div class="flex-grow">
                            <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200">${product.name}</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Magazin: ${product.store}</p>
                        </div>
                        <button class="remove-from-wishlist-btn bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-colors duration-200" data-product-id="${product.id}">
                            &times;
                        </button>
                    `;
                    wishlistItemsContainer.appendChild(wishlistItemDiv);

         
                    wishlistItemDiv.querySelector('.remove-from-wishlist-btn').addEventListener('click', () => {
                        removeFromWishlist(product.id);
                    });
                }
            });
        }


        document.getElementById('close-modal-btn').addEventListener('click', hideProductModal);

        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon'); 
        const body = document.body;

        function setTheme(isDarkMode) {
            if (isDarkMode) {
                body.classList.add('dark-mode');
                themeIcon.textContent = '🌙'; 
                localStorage.setItem('theme', 'dark');
            } else {
                body.classList.remove('dark-mode');
                themeIcon.textContent = '☀️'; 
                localStorage.setItem('theme', 'light');
            }
        }

        function toggleCategoryNav() {
            const categoryButtonsContainer = document.getElementById('category-buttons-container');
            const categoryToggleBtn = document.getElementById('category-toggle-btn');
            isCategoryNavExpanded = !isCategoryNavExpanded;

            if (isCategoryNavExpanded) {
                categoryButtonsContainer.classList.add('is-expanded');
                categoryToggleBtn.classList.add('rotated');
            } else {
                categoryButtonsContainer.classList.remove('is-expanded');
                categoryToggleBtn.classList.remove('rotated');
            }
        }

        const sparkCanvas = document.getElementById('sparkCanvas');
        const sparkCtx = sparkCanvas.getContext('2d');
        let sparks = [];

        function resizeSparkCanvas() {
            sparkCanvas.width = window.innerWidth;
            sparkCanvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeSparkCanvas);
        resizeSparkCanvas();

        class Spark {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.size = Math.random() * 3 + 1;
                this.life = 30 + Math.random() * 20;
                this.maxLife = this.life;
                this.color = `hsl(${Math.random() * 60 + 20}, 100%, 70%)`;
                this.vx = (Math.random() * 10 - 7);
                this.vy = (Math.random() * -10 - 5);
                this.gravity = 0.3;
                this.friction = 0.95;
            }

            update() {
                this.vx *= this.friction;
                this.vy *= this.friction;
                this.vy += this.gravity;

                this.x += this.vx;
                this.y += this.vy;

                this.life--;
            }

            draw() {
                sparkCtx.save();
                sparkCtx.beginPath();
                sparkCtx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                sparkCtx.fillStyle = this.color;
                sparkCtx.globalAlpha = this.life / this.maxLife;
                sparkCtx.fill();
                sparkCtx.restore();
            }
        }

        function animateSparks() {
            sparkCtx.clearRect(0, 0, sparkCanvas.width, sparkCanvas.height);

            for (let i = sparks.length - 1; i >= 0; i--) {
                const spark = sparks[i];
                spark.update();
                spark.draw();

                if (spark.life <= 0) {
                    sparks.splice(i, 1);
                }
            }

            requestAnimationFrame(animateSparks);
        }

        animateSparks();

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            loadWishlist(); 
            renderCategoryButtons();
            renderProducts();
            updateWishlistCountBadge(); 

            
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                setTheme(true);
            } else {
                setTheme(false);
            }

            themeToggleBtn.addEventListener('click', () => {
                const isDarkMode = body.classList.contains('dark-mode');
                setTheme(!isDarkMode);

              
                themeToggleBtn.classList.add('button-active-animation');
                themeIcon.classList.add('icon-active-rotation');

                
                setTimeout(() => {
                    themeToggleBtn.classList.remove('button-active-animation');
                    themeIcon.classList.remove('icon-active-rotation');
                }, 400); 

                const rect = themeToggleBtn.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                for (let i = 0; i < 20; i++) {
                    sparks.push(new Spark(centerX, centerY));
                }
            });

            document.getElementById('category-toggle-btn').addEventListener('click', toggleCategoryNav);


            document.getElementById('view-wishlist-btn').addEventListener('click', () => {
                renderWishlistItems();
                document.getElementById('wishlist-modal').classList.remove('hidden');
            });

            document.getElementById('close-wishlist-modal-btn').addEventListener('click', () => {
                document.getElementById('wishlist-modal').classList.add('hidden');
            });
        });

        window.addEventListener('resize', () => {
            const categoryButtonsContainer = document.getElementById('category-buttons-container');
            const mobileToggleDiv = document.querySelector('.md\\:hidden');

            if (window.innerWidth < 768) {
                mobileToggleDiv.classList.remove('hidden');
                mobileToggleDiv.classList.add('flex');
                if (!isCategoryNavExpanded) {
                    categoryButtonsContainer.classList.remove('is-expanded');
                    document.getElementById('category-toggle-btn').classList.remove('rotated');
                }
            } else {
                mobileToggleDiv.classList.add('hidden');
                mobileToggleDiv.classList.remove('flex');
                categoryButtonsContainer.classList.remove('is-expanded');
                document.getElementById('category-toggle-btn').classList.remove('rotated');
                isCategoryNavExpanded = false;
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            const mobileToggleDiv = document.querySelector('.md\\:hidden');
            if (window.innerWidth < 768) {
                mobileToggleDiv.classList.remove('hidden');
                mobileToggleDiv.classList.add('flex');
            } else {
                mobileToggleDiv.classList.add('hidden');
                mobileToggleDiv.classList.remove('flex');
            }
        });
    </script>

</body>
</html>
